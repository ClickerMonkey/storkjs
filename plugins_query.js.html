<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <title>Source: plugins/query.js</title>
    
    
    <script src="scripts/prettify/prettify.js"></script>
    <script src="scripts/prettify/lang-css.js"></script>
    <script src="scripts/jquery.min.js"></script>
    <!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <link type="text/css" rel="stylesheet" href="styles/prettify-tomorrow.css">
    <link type="text/css" rel="stylesheet" href="styles/bootstrap.min.css">
    <link type="text/css" rel="stylesheet" href="styles/jaguar.css">
    
    
    <script>
    var config = {"monospaceLinks":false,"cleverLinks":true,"applicationName":"Stork JS","linenums":true,"default":{"outputSourceFiles":true}};
    </script>
    

    
</head>
<body>
<div id="wrap" class="clearfix">
    
<div class="navigation">
    <h3 class="applicationName"><a href="index.html">Stork JS</a></h3>

    <div class="search">
        <input id="search" type="text" class="form-control input-sm" placeholder="Search Documentations">
    </div>
    <ul class="list">
    
        <li class="item" data-name="Stork">
            <span class="title">
                <a href="Stork.html">Stork</a>
                
            </span>
            <ul class="members itemMembers">
            
            <span class="subtitle">Members</span>
            
                <li data-name="Stork.adapters"><a href="Stork.html#.adapters">adapters</a></li>
            
                <li data-name="Stork.plugins"><a href="Stork.html#.plugins">plugins</a></li>
            
                <li data-name="Stork#adapter"><a href="Stork.html#adapter">adapter</a></li>
            
                <li data-name="Stork#cache"><a href="Stork.html#cache">cache</a></li>
            
                <li data-name="Stork#initialized"><a href="Stork.html#initialized">initialized</a></li>
            
                <li data-name="Stork#key"><a href="Stork.html#key">key</a></li>
            
                <li data-name="Stork#lazy"><a href="Stork.html#lazy">lazy</a></li>
            
                <li data-name="Stork#loaded"><a href="Stork.html#loaded">loaded</a></li>
            
                <li data-name="Stork#name"><a href="Stork.html#name">name</a></li>
            
                <li data-name="Stork#options"><a href="Stork.html#options">options</a></li>
            
                <li data-name="Stork#pending"><a href="Stork.html#pending">pending</a></li>
            
            </ul>
            <ul class="typedefs itemMembers">
            
            <span class="subtitle">Typedefs</span>
            
                <li data-name="Stork~aggregateAccumulate"><a href="Stork.html#~aggregateAccumulate">aggregateAccumulate</a></li>
            
                <li data-name="Stork~aggregateFailure"><a href="Stork.html#~aggregateFailure">aggregateFailure</a></li>
            
                <li data-name="Stork~aggregateResult"><a href="Stork.html#~aggregateResult">aggregateResult</a></li>
            
                <li data-name="Stork~aggregateSuccess"><a href="Stork.html#~aggregateSuccess">aggregateSuccess</a></li>
            
                <li data-name="Stork~allFailure"><a href="Stork.html#~allFailure">allFailure</a></li>
            
                <li data-name="Stork~allSuccess"><a href="Stork.html#~allSuccess">allSuccess</a></li>
            
                <li data-name="Stork~batchFailure"><a href="Stork.html#~batchFailure">batchFailure</a></li>
            
                <li data-name="Stork~batchSuccess"><a href="Stork.html#~batchSuccess">batchSuccess</a></li>
            
                <li data-name="Stork~destroyFailure"><a href="Stork.html#~destroyFailure">destroyFailure</a></li>
            
                <li data-name="Stork~destroySuccess"><a href="Stork.html#~destroySuccess">destroySuccess</a></li>
            
                <li data-name="Stork~eachFailure"><a href="Stork.html#~eachFailure">eachFailure</a></li>
            
                <li data-name="Stork~eachSuccess"><a href="Stork.html#~eachSuccess">eachSuccess</a></li>
            
                <li data-name="Stork~getFailure"><a href="Stork.html#~getFailure">getFailure</a></li>
            
                <li data-name="Stork~getManyFailure"><a href="Stork.html#~getManyFailure">getManyFailure</a></li>
            
                <li data-name="Stork~getManySuccess"><a href="Stork.html#~getManySuccess">getManySuccess</a></li>
            
                <li data-name="Stork~getSuccess"><a href="Stork.html#~getSuccess">getSuccess</a></li>
            
                <li data-name="Stork~initFailure"><a href="Stork.html#~initFailure">initFailure</a></li>
            
                <li data-name="Stork~initSuccess"><a href="Stork.html#~initSuccess">initSuccess</a></li>
            
                <li data-name="Stork~plugin"><a href="Stork.html#~plugin">plugin</a></li>
            
                <li data-name="Stork~putFailure"><a href="Stork.html#~putFailure">putFailure</a></li>
            
                <li data-name="Stork~putSuccess"><a href="Stork.html#~putSuccess">putSuccess</a></li>
            
                <li data-name="Stork~reloadFailure"><a href="Stork.html#~reloadFailure">reloadFailure</a></li>
            
                <li data-name="Stork~reloadSuccess"><a href="Stork.html#~reloadSuccess">reloadSuccess</a></li>
            
                <li data-name="Stork~removeFailure"><a href="Stork.html#~removeFailure">removeFailure</a></li>
            
                <li data-name="Stork~removeManyFailure"><a href="Stork.html#~removeManyFailure">removeManyFailure</a></li>
            
                <li data-name="Stork~removeManySuccess"><a href="Stork.html#~removeManySuccess">removeManySuccess</a></li>
            
                <li data-name="Stork~removeSuccess"><a href="Stork.html#~removeSuccess">removeSuccess</a></li>
            
                <li data-name="Stork~saveFailure"><a href="Stork.html#~saveFailure">saveFailure</a></li>
            
                <li data-name="Stork~saveSuccess"><a href="Stork.html#~saveSuccess">saveSuccess</a></li>
            
                <li data-name="Stork~selectFailure"><a href="Stork.html#~selectFailure">selectFailure</a></li>
            
                <li data-name="Stork~selectSuccess"><a href="Stork.html#~selectSuccess">selectSuccess</a></li>
            
                <li data-name="Stork~sizeFailure"><a href="Stork.html#~sizeFailure">sizeFailure</a></li>
            
                <li data-name="Stork~sizeSuccess"><a href="Stork.html#~sizeSuccess">sizeSuccess</a></li>
            
                <li data-name="Stork~sortComparator"><a href="Stork.html#~sortComparator">sortComparator</a></li>
            
                <li data-name="Stork~sortFailure"><a href="Stork.html#~sortFailure">sortFailure</a></li>
            
                <li data-name="Stork~sortSuccess"><a href="Stork.html#~sortSuccess">sortSuccess</a></li>
            
                <li data-name="Stork~where"><a href="Stork.html#~where">where</a></li>
            
                <li data-name="Stork~whereFailure"><a href="Stork.html#~whereFailure">whereFailure</a></li>
            
                <li data-name="Stork~whereSuccess"><a href="Stork.html#~whereSuccess">whereSuccess</a></li>
            
            </ul>
            <ul class="methods itemMembers">
            
            <span class="subtitle">Methods</span>
            
                <li data-name="Stork.adapter"><a href="Stork.html#.adapter">adapter</a></li>
            
                <li data-name="Stork.plugin"><a href="Stork.html#.plugin">plugin</a></li>
            
                <li data-name="Stork#aggregate"><a href="Stork.html#aggregate">aggregate</a></li>
            
                <li data-name="Stork#all"><a href="Stork.html#all">all</a></li>
            
                <li data-name="Stork#avg"><a href="Stork.html#avg">avg</a></li>
            
                <li data-name="Stork#batch"><a href="Stork.html#batch">batch</a></li>
            
                <li data-name="Stork#count"><a href="Stork.html#count">count</a></li>
            
                <li data-name="Stork#destroy"><a href="Stork.html#destroy">destroy</a></li>
            
                <li data-name="Stork#each"><a href="Stork.html#each">each</a></li>
            
                <li data-name="Stork#get"><a href="Stork.html#get">get</a></li>
            
                <li data-name="Stork#getMany"><a href="Stork.html#getMany">getMany</a></li>
            
                <li data-name="Stork#init"><a href="Stork.html#init">init</a></li>
            
                <li data-name="Stork#max"><a href="Stork.html#max">max</a></li>
            
                <li data-name="Stork#min"><a href="Stork.html#min">min</a></li>
            
                <li data-name="Stork#put"><a href="Stork.html#put">put</a></li>
            
                <li data-name="Stork#reload"><a href="Stork.html#reload">reload</a></li>
            
                <li data-name="Stork#remove"><a href="Stork.html#remove">remove</a></li>
            
                <li data-name="Stork#removeMany"><a href="Stork.html#removeMany">removeMany</a></li>
            
                <li data-name="Stork#save"><a href="Stork.html#save">save</a></li>
            
                <li data-name="Stork#select"><a href="Stork.html#select">select</a></li>
            
                <li data-name="Stork#size"><a href="Stork.html#size">size</a></li>
            
                <li data-name="Stork#sort"><a href="Stork.html#sort">sort</a></li>
            
                <li data-name="Stork#sum"><a href="Stork.html#sum">sum</a></li>
            
                <li data-name="Stork#then"><a href="Stork.html#then">then</a></li>
            
                <li data-name="Stork#valid"><a href="Stork.html#valid">valid</a></li>
            
                <li data-name="Stork#where"><a href="Stork.html#where">where</a></li>
            
            </ul>
            <ul class="events itemMembers">
            
            </ul>
        </li>
    
        <li class="item" data-name="Stork.FastMap">
            <span class="title">
                <a href="Stork.FastMap.html">Stork.FastMap</a>
                
            </span>
            <ul class="members itemMembers">
            
            <span class="subtitle">Members</span>
            
                <li data-name="Stork.FastMap#indices"><a href="Stork.FastMap.html#indices">indices</a></li>
            
                <li data-name="Stork.FastMap#keys"><a href="Stork.FastMap.html#keys">keys</a></li>
            
                <li data-name="Stork.FastMap#okeys"><a href="Stork.FastMap.html#okeys">okeys</a></li>
            
                <li data-name="Stork.FastMap#values"><a href="Stork.FastMap.html#values">values</a></li>
            
            </ul>
            <ul class="typedefs itemMembers">
            
            </ul>
            <ul class="methods itemMembers">
            
            <span class="subtitle">Methods</span>
            
                <li data-name="Stork.FastMap#get"><a href="Stork.FastMap.html#get">get</a></li>
            
                <li data-name="Stork.FastMap#has"><a href="Stork.FastMap.html#has">has</a></li>
            
                <li data-name="Stork.FastMap#hasOverlap"><a href="Stork.FastMap.html#hasOverlap">hasOverlap</a></li>
            
                <li data-name="Stork.FastMap#indexOf"><a href="Stork.FastMap.html#indexOf">indexOf</a></li>
            
                <li data-name="Stork.FastMap#overwrite"><a href="Stork.FastMap.html#overwrite">overwrite</a></li>
            
                <li data-name="Stork.FastMap#put"><a href="Stork.FastMap.html#put">put</a></li>
            
                <li data-name="Stork.FastMap#putMap"><a href="Stork.FastMap.html#putMap">putMap</a></li>
            
                <li data-name="Stork.FastMap#rebuildIndex"><a href="Stork.FastMap.html#rebuildIndex">rebuildIndex</a></li>
            
                <li data-name="Stork.FastMap#remove"><a href="Stork.FastMap.html#remove">remove</a></li>
            
                <li data-name="Stork.FastMap#removeAt"><a href="Stork.FastMap.html#removeAt">removeAt</a></li>
            
                <li data-name="Stork.FastMap#reset"><a href="Stork.FastMap.html#reset">reset</a></li>
            
                <li data-name="Stork.FastMap#reverse"><a href="Stork.FastMap.html#reverse">reverse</a></li>
            
                <li data-name="Stork.FastMap#size"><a href="Stork.FastMap.html#size">size</a></li>
            
                <li data-name="Stork.FastMap#sort"><a href="Stork.FastMap.html#sort">sort</a></li>
            
            </ul>
            <ul class="events itemMembers">
            
            </ul>
        </li>
    
        <li class="item" data-name="Stork.Promise">
            <span class="title">
                <a href="Stork.Promise.html">Stork.Promise</a>
                
            </span>
            <ul class="members itemMembers">
            
            <span class="subtitle">Members</span>
            
                <li data-name="Stork.Promise.CHAINED"><a href="Stork.Promise.html#.CHAINED">CHAINED</a></li>
            
                <li data-name="Stork.Promise.FAILURE"><a href="Stork.Promise.html#.FAILURE">FAILURE</a></li>
            
                <li data-name="Stork.Promise.PENDING"><a href="Stork.Promise.html#.PENDING">PENDING</a></li>
            
                <li data-name="Stork.Promise.SUCCESS"><a href="Stork.Promise.html#.SUCCESS">SUCCESS</a></li>
            
                <li data-name="Stork.Promise#args"><a href="Stork.Promise.html#args">args</a></li>
            
                <li data-name="Stork.Promise#chainFailureResult"><a href="Stork.Promise.html#chainFailureResult">chainFailureResult</a></li>
            
                <li data-name="Stork.Promise#context"><a href="Stork.Promise.html#context">context</a></li>
            
                <li data-name="Stork.Promise#errors"><a href="Stork.Promise.html#errors">errors</a></li>
            
                <li data-name="Stork.Promise#failures"><a href="Stork.Promise.html#failures">failures</a></li>
            
                <li data-name="Stork.Promise#next"><a href="Stork.Promise.html#next">next</a></li>
            
                <li data-name="Stork.Promise#root"><a href="Stork.Promise.html#root">root</a></li>
            
                <li data-name="Stork.Promise#state"><a href="Stork.Promise.html#state">state</a></li>
            
                <li data-name="Stork.Promise#successes"><a href="Stork.Promise.html#successes">successes</a></li>
            
            </ul>
            <ul class="typedefs itemMembers">
            
            </ul>
            <ul class="methods itemMembers">
            
            <span class="subtitle">Methods</span>
            
                <li data-name="Stork.Promise.Done"><a href="Stork.Promise.html#.Done">Done</a></li>
            
                <li data-name="Stork.Promise.Group"><a href="Stork.Promise.html#.Group">Group</a></li>
            
                <li data-name="Stork.Promise#either"><a href="Stork.Promise.html#either">either</a></li>
            
                <li data-name="Stork.Promise#error"><a href="Stork.Promise.html#error">error</a></li>
            
                <li data-name="Stork.Promise#then"><a href="Stork.Promise.html#then">then</a></li>
            
            </ul>
            <ul class="events itemMembers">
            
            </ul>
        </li>
    
    </ul>
</div>
    <div class="main">
        <h1 class="page-title" data-filename="plugins_query.js.html">Source: plugins/query.js</h1>
        


    
    <section>
        <article>
            <pre class="prettyprint source linenums"><code>Stork.plugin((function()
{

  /**
   * The format of the condition callback for {@link Stork#where}.
   * 
   * @callback Stork~where
   * @param {Any} value
   *        The value to inspect and return true if you want it returned.
   * @param {Any} key
   *        The key to inspect and return true if you want it returned.
   */
  
  /**
   * The format of success callback for {@link Stork#where}.
   * 
   * @callback Stork~whereSuccess
   * @param {Array} values
   *        The values matching the given condition.
   * @param {Array} keys
   *        The keys matching the given condition.
   */

  /**
   * The format of failure callback for {@link Stork#where}.
   * 
   * @callback Stork~whereFailure
   * @param {Any} error 
   *        The error that was thrown.
   */

  /**
   * Returns a subset of key-value pairs that match a condition function to the 
   * callback.
   *
   * This is part of the query plugin.
   *
   * *Usage*
   * ```javascript
   * var condition = function(value, key) {
   *   // return true if key-value matches some condition
   * };
   * var onSuccessFunc = function(value, key) {
   *   // handle success
   * };
   * var onFailureFunc = function(key, error) {
   *   // uh oh!
   * };
   * db.where( condition, onSucessFunc, onFailureFunc ); // listen for success/failure
   * db.where( condition ).then( onSuccessFunc, onFailureFunc ); // listen to promise
   * ```
   *
   * @memberOf Stork#
   * @param  {Stork~where} condition
   *         The function to invoke on each key-value pair to determine whether
   *         that pair is included in the results.
   * @param  {Stork~whereSuccess} [success]
   *         The function to invoke with the matched key-value pairs.
   * @param  {Stork~whereFailure} [failure]
   *         The function to invoke if there was a problem retrieving the
   *         key-value pairs.
   * @return {Stork.Promise} -
   *         The promise that can be used to listen for success or failure, as
   *         well as chaining additional calls.
   */
  function where(condition, promise)
  {
    var onSuccess = function(values, keys)
    {
      var matchedKeys = [];
      var matchedValues = [];

      for (var i = 0; i &lt; values.length; i++)
      {
        var v = values[ i ];
        var k = keys[ i ];

        if ( condition( v, k ) )
        {
          matchedValues.push( v );
          matchedKeys.push( k );
        }
      }

      promise.$success( [matchedValues, matchedKeys] );
    };
    var onFailure = function(e)
    {
      promise.$failure( [e] );
    };

    this.all( onSuccess, onFailure );
  }

  /**
   * The format of success callback for {@link Stork#select}.
   * 
   * @callback Stork~selectSuccess
   * @param {Array} values
   *        If columns is a string this is an array of values pulled from the
   *        same property on all values that are objects. If columns is an array
   *        this is an array of objects containing the properties that exist
   *        in the columns array.
   * @param {Array} keys
   *        An array of the keys for pointing to the original values.
   */

  /**
   * The format of failure callback for {@link Stork#select}.
   * 
   * @callback Stork~selectFailure
   * @param {String|Array} columns
   *        The property you wanted to return or an array of properties to return.
   * @param {Any} error 
   *        The error that was thrown.
   */
  
  /**
   * Returns column values (if columns is a string) or an array of objects of 
   * column values (if columns is an array) to the callback.
   *
   * This is part of the query plugin.
   *
   * *Usage*
   * ```javascript
   * var onSuccessFunc = function(values, keys) {
   *   // handle success
   * };
   * var onFailureFunc = function(columns, error) {
   *   // uh oh!
   * };
   * db.select( 'name', onSucessFunc, onFailureFunc ); // listen for success/failure
   * db.select( ['name', 'id'] ).then( onSuccessFunc, onFailureFunc ); // listen to promise
   * ```
   *
   * @memberOf Stork#
   * @param  {String|Array} columns
   *         The property you want to return or an array of properties to return.
   * @param  {Stork~selectSuccess} [success]
   *         The function to invoke with the selected properties.
   * @param  {Stork~selectFailure} [failure]
   *         The function to invoke if there was a problem selecting the columns.
   * @return {Stork.Promise} -
   *         The promise that can be used to listen for success or failure, as
   *         well as chaining additional calls.
   */
  function select(columns, promise)
  {
    var onSuccess = function(values, keys)
    {
      var results = [];
      var resultKeys = [];

      for (var i = 0; i &lt; values.length; i++)
      {
        var v = values[ i ];

        if ( isObject( v ) )
        {
          if ( isString( columns ) )
          {
            if ( columns in v )
            {
              results.push( v[ columns ] );
              resultKeys.push( keys[ i ] );
            }
          }
          else if ( isArray( columns ) )
          {
            var resultObject = {};
            var resultColumns = 0;

            for (var k = 0; k &lt; columns.length; k++)
            {
              var c = columns[ k ];

              if ( c in v )
              {
                resultObject[ c ] = v[ c ];
                resultColumns++;
              }
            }

            if ( resultColumns > 0 )
            {
              results.push( resultObject );
              resultKeys.push( keys[ i ] );
            }
          }
        }
      }

      promise.$success( [results, resultKeys] );
    };
    var onFailure = function(e)
    {
      promise.$failure( [columns, e] );
    };

    this.all( onSuccess, onFailure );
  }

  /**
   * The format of the comparater for {@link Stork#sort}.
   *
   * @callback Stork~sortComparator
   * @param {Any} a
   *        The first value to compare.
   * @param {Any} b
   *        The second value to compare.
   * @return {Number} -
   *         A negative number if `a &lt; b`, a positive number of `a > b` and 0
   *         if `a == b`.
   */

  /**
   * The format of success callback for {@link Stork#sort}.
   * 
   * @callback Stork~sortSuccess
   * @param {Array} values
   *        The array of sorted values.
   * @param {Array} keys
   *        The array of sorted keys.
   */

  /**
   * The format of failure callback for {@link Stork#sort}.
   * 
   * @callback Stork~sortFailure
   * @param {Any} error 
   *        The error that was thrown.
   */
  
  /**
   * Sorts all key-value pairs and returns them to the callback. Next time the
   * key-value pairs are iterated over they will be returned in the same order.
   * The underlying structure should be considered unsorted anytime key-value
   * pairs are updated, added, or removed.
   *
   * This is part of the query plugin.
   *
   * *Usage*
   * ```javascript
   * var compareFunc = function(a, b) {
   *   // compare a &amp; b and return a number
   * };
   * var onSuccessFunc = function(values, keys) {
   *   // handle success
   * };
   * var onFailureFunc = function(error) {
   *   // uh oh!
   * };
   * db.sort( compareFunc, false, onSucessFunc, onFailureFunc ); // listen for success/failure
   * db.sort( compareFunc ).then( onSuccessFunc, onFailureFunc ); // listen to promise
   * ```
   *
   * @memberOf Stork#
   * @param  {Stork~sortComparator} comparator
   *         The function used to compare two values.
   * @param  {Boolean} desc
   *         If the key-value pairs should be in descending (reversed) order.
   * @param  {Stork~sortSuccess} [success]
   *         The function to invoke with the sorted values &amp; keys.
   * @param  {Stork~sortFailure} [failure]
   *         The function to invoke if there was a problem sorting the pairs.
   * @return {Stork.Promise} -
   *         The promise that can be used to listen for success or failure, as
   *         well as chaining additional calls.
   */
  function sort(comparator, desc, promise)
  {
    var onSuccess = function()
    {
      var cache = this.cache;

      cache.sort( comparator );

      if ( desc )
      {
        cache.reverse();
      }

      promise.$success( [cache.values, cache.okeys] );
    };
    var onFailure = function(e)
    {
      promise.$failure( [e] );
    };

    this.all( onSuccess, onFailure );
  }

  var METHODS = 
  {
    where:  $promise( 'where', where ),
    select: $promise( 'select', select ),
    sort:   $promise( 'sort', sort )
  }; 

  return function(stork)
  {
    copy( METHODS, stork );
  };

})());


  </code></pre>
        </article>
    </section>






        

        <footer>
            Documentation generated by <a href="https://github.com/jsdoc3/jsdoc">JSDoc 3.3.3</a> on Sun Oct 25 2015 14:25:39 GMT-0400 (EDT)
        </footer>
    </div>
</div>
<script>prettyPrint();</script>
<script src="scripts/linenumber.js"></script>
<script src="scripts/main.js"></script>
</body>
</html>
