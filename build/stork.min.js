"use strict";!function(t,e){function n(t){return!!(t&&t.constructor&&t.call&&t.apply)}function i(t){return"object"==typeof t&&null!==t}function s(t){return"number"==typeof t&&!isNaN(t)}function r(t){return t instanceof Array}function a(t){return"string"==typeof t}function u(t){return"undefined"==typeof t}function o(t){return"undefined"!=typeof t}function c(t,e){t.length=0,t.push.apply(t,e)}function h(t,e,n,i){return o(t)?t:o(e)?e:o(n)?n:i}function f(t,e,n){var i=t[e];t[e]=t[n],t[n]=i}function l(t,e){for(var n in t)e[n]=t[n];return e}function d(){return(65536*(1+Math.random())|0).toString(16).substring(1)}function v(){return d()+d()+"-"+d()+"-"+d()+"-"+d()+"-"+d()+d()+d()}function p(t,e){var n=e.priority-t.priority;return 0===n?0:0>n?-1:1}function g(t,e){return function(){var n=new y(this,success,failure);if(this.handlePending(this[t],arguments,n))return n;var i=Array.prototype.slice.call(arguments);return i.pop(),i.pop(),i.push(n),e.apply(this,i),n}}function m(t){if(t)for(var e=0;e<$.adapters.length;e++){var n=$.adapters[e];if(n.name===t&&n.definition.valid())return n}if(!m.chosen){$.adapters.sort(p);for(var e=0;e<$.adapters.length;e++){var n=$.adapters[e];if(n.definition.valid())return m.chosen=n}}return m.chosen}function $(t,e,n){if(!(this instanceof $))return new $(t,e,n);if(!JSON)throw"JSON unavailable! Include http://www.json.org/json2.js to fix.";this.options=t=t||{},this.key=h(t.key,"id"),this.name=h(t.name,""),this.lazy=h(t.lazy,!1),this.cache=new w,this.pending=[],this.initialized=!1,this.loaded=!1,this.adapter=m(t.adapter),l(this.adapter.definition,this);for(var i=0;i<$.plugins.length;i++)$.plugins[i](this);this.initializing=this.init(this.options,e,n)}function y(t,e,n,i){this.context=t,this.root=i||this,this.next=null,this.nextFromSuccess=null,this.state=y.PENDING,this.successes=[],this.failures=[],this.errors=[],this.args=null,this.$queue(e,n)}function w(t){this.values=[],this.keys=[],this.okeys=[],this.indices={},this.putMap(t)}var S=JSON.stringify,E=JSON.parse;$.prototype={decode:E,encode:S,handlePending:function(t,e,n){var i=!this.initialized;return i&&(this.pending.push({method:t,arguments:Array.prototype.slice.call(e),promise:n}),n&&n.$reset()),i},finishInitialization:function(t,e){if(!this.initialized){this.initialized=!0,t.$success(e);for(var n=0;n<this.pending.length;n++){var i=this.pending[n],s=i.method.apply(this,i.arguments);i.promise&&i.promise.$bindTo(s)}this.pending=null}return this},finishReload:function(t){if(t.$pending()){var e=this.cache;this.initialized?t.$success([e.values,e.okeys]):this.finishInitialization(t,[e.values,e.okeys])}},valid:function(){throw"Stork.valid is not implemented"},init:function(t,e,n){throw"Stork.init is not implemented"},reload:function(t,e){throw"Stork.reload is not implemented"},then:function(t){return t.apply(this)},getMany:function(t,e,n){var i=new y(this,e,n);if(this.handlePending(this.getMany,arguments,i))return i;for(var s=0,r=[],a=function(e){return function(n){r[e]=n,++s===t.length&&i.$success([r,t])}},u=function(e){i.$failure([t,e])},o=0;o<t.length;o++)this.get(t[o],a(o),u);return i},get:function(t,n,i){var s=new y(this,n,i);if(this.handlePending(this.get,arguments,s))return s;var r;try{r=this.encode(t)}catch(a){s.$failure([t,a])}return s.$pending()&&(this.cache.has(r)?s.$success([this.cache.get(r),t]):this.loaded?s.$success([e,t]):this._get(t,r,s)),s},_get:function(t,e,n){throw"Stork._get is not implemented"},destroy:function(t,e){var n=new y(this,t,e);return this.handlePending(this.destroy,arguments,n)?n:(this._destroy(n),n)},_destroy:function(t){throw"Stork._destroy is not implemented"},save:function(t,e,n){var i=new y(this,e,n);if(this.handlePending(this.save,arguments,i))return i;var s=this.key,r=t[s];u(r)&&(r=t[s]=v());var a=function(t,e){i.$success([e])},o=function(t,e,n){i.$failure([e,n])};return this.put(r,t,a,o),i},batch:function(t,e,n){var i=new y(this,e,n);if(this.handlePending(this.batch,arguments,i))return i;for(var s=0,r=function(){++s===t.length&&i.$success([t])},a=function(e){i.$failure([t,s,e])},u=0;u<t.length&&!i.state;u++)this.save(t[u],r,a);return i},put:function(t,e,n,i){var s=new y(this,n,i);if(this.handlePending(this.put,arguments,s))return s;var r,a;try{r=this.encode(t),a=S(e)}catch(u){s.$failure([t,e,u])}return s.$pending()&&this._put(t,e,r,a,s),s},_put:function(t,e,n,i,s){throw"Stork._put is not implemented"},remove:function(t,n,i){var s=new y(this,n,i);if(this.handlePending(this.remove,arguments,s))return s;var r;try{r=this.encode(t)}catch(a){s.$failure([t,a])}if(s.$pending())if(this.loaded&&!this.cache.has(r))s.$success([e,t]);else{var u=this.cache.get(r);this._remove(t,r,u,s)}return s},_remove:function(t,e,n,i){throw"Stork._remove is not implemented"},removeMany:function(t,e,n){var i=new y(this,e,n);if(this.handlePending(this.removeMany,arguments,i))return i;for(var s=[],r=0,a=function(e){return function(n){s[e]=n,++r===t.length&&i.$success([s,t])}},u=function(t){i.$failure([s,r,t])},o=0;o<t.length;o++)this.remove(t[o],a(o),u);return i},each:function(t,e){if(!n(t)||this.handlePending(this.each,arguments))return this;var i=this,s=function(e,n){for(var s=0;s<e.length;s++)t.call(i,e[s],n[s])};if(this.loaded){var r=this.cache.okeys,a=this.cache.values;s(a,r)}else this.reload(s,e);return this},size:function(t,e){var n=new y(this,t,e);return this.handlePending(this.size,arguments,n)?n:(this.loaded?n.$success([this.cache.size()]):this._size(n),n)},_size:function(t){throw"Stork._size is not implemented"},all:function(t,e){var n=new y(this,t,e);if(this.handlePending(this.all,arguments,n))return n;var i=function(t,e){n.$success([t,e])},s=function(t){n.$failure([t])};if(this.loaded){var r=this.cache.okeys,a=this.cache.values;i(a,r)}else this.reload(i,s);return n}},y.PENDING=0,y.FAILURE=1,y.SUCCESS=2,y.CHAINED=3,y.prototype={then:function(t,n){return this.$queue(t,n),this.next||(this.next=new y(this.context,e,e,this)),this.state&y.SUCCESS?this.$handleSuccesses():this.state===y.FAILURE&&this.$handleFailures(),this.next},error:function(t){return n(t)&&(this.root.errors.push(t),this.state===y.FAILURE&&this.$handleFailures()),this},$bindTo:function(t,e){var n=this;t.then(function(){n.context=t.context,n.$success(h(e,t.args))},function(){n.context=t.context,n.$failure(h(e,t.args))})},$pending:function(){return this.state===y.PENDING},$queue:function(t,e){n(t)&&this.successes.push(t),n(e)&&this.failures.push(e)},$handleSuccesses:function(){for(var t=this.successes,e=0;e<t.length;e++){var n=t[e],i=n.apply(this.context,this.args);i instanceof y&&!this.nextFromSuccess&&(this.nextFromSuccess=i)}t.length=0,this.$handleNext()},$handleNext:function(){var t=this.next,e=this.nextFromSuccess;t&&e&&this.state===y.SUCCESS&&(t.$bindTo(e),this.state=y.CHAINED)},$success:function(t){return this.state===y.PENDING&&(this.args=t||[],this.state=y.SUCCESS,this.$handleSuccesses()),this},$handleFailures:function(){for(var t=this.failures,e=0;e<t.length;e++)t[e].apply(this.context,this.args);t.length=0;for(var n=this.root.errors,i=[this.args[this.args.length-1]],e=0;e<n.length;e++)n[e].apply(this.context,i);n.length=0},$failure:function(t){return this.state===y.PENDING&&(this.args=t||[],this.state=y.FAILURE,this.$handleFailures()),this},$reset:function(){this.state=y.PENDING,this.successes.length=0,this.failures.length=0,this.errors.length=0}},w.prototype={reset:function(){return this.values.length=0,this.keys.length=0,this.okeys.length=0,this.indices={},this},put:function(t,e,n){return t in this.indices?this.values[this.indices[t]]=e:(this.indices[t]=this.values.length,this.values.push(e),this.keys.push(t),this.okeys.push(n)),this},putMap:function(t){if(t instanceof w)for(var e=t.keys,n=t.values,s=t.okeys,r=0;r<e.length;r++)this.put(e[r],n[r],s[r]);else if(i(t))for(var a in t)this.put(a,t[a],a);return this},get:function(t){return this.values[this.indices[t]]},remove:function(t){var e=this.indices[t];return s(e)&&this.removeAt(e),this},overwrite:function(t){return c(this.values,t.values),c(this.keys,t.keys),c(this.okeys,t.okeys),this.rebuildIndex(),this},removeAt:function(t){var e=this.keys[t],n=this.values.pop(),i=this.keys.pop(),s=this.okeys.pop();return t<this.values.length&&(this.values[t]=n,this.keys[t]=i,this.okeys[t]=s,this.indices[i]=t),delete this.indices[e],this},indexOf:function(t){return h(this.indices[t],-1)},has:function(t){return t in this.indices},hasOverlap:function(t){for(var e=this.keys,n=t.indices,i=0;i<e.length;i++)if(e[i]in n)return!0;return!1},size:function(){return this.values.length},reverse:function(){for(var t=this.size()-1,e=Math.ceil(t/2),n=0;e>n;n++)f(this.values,n,t-n),f(this.keys,n,t-n),f(this.okeys,n,t-n);return this.rebuildIndex(),this},sort:function(t){function e(e,n){for(var s=i.values[Math.floor((n+e)/2)],r=e,a=n;a>=r;){for(;t(i.values[r],s)<0;)r++;for(;t(i.values[a],s)>0;)a--;a>=r&&(f(i.values,r,a),f(i.keys,r,a),f(i.okeys,r,a),r++,a--)}return r}function n(t,i){var s=e(t,i);s-1>t&&n(t,s-1),i>s&&n(s,i)}var i=this,s=this.size()-1;return s>0&&(n(0,s),this.rebuildIndex()),this},rebuildIndex:function(){this.indices={};for(var t=0,e=this.keys.length;e>t;t++)this.indices[this.keys[t]]=t;return this}},$.plugins=[],$.plugin=function(t){return n(t)&&$.plugins.push(t),$},$.adapters=[],$.adapter=function(t,e,i){return $.adapters.push({name:t,priority:e,definition:n(i)?i():i}),$},$.plugin(function(){function t(t,e,n,s){var r=function(r,a){for(var u=0;u<r.length;u++){var o=r[u];i(o)&&t in o&&e(o[t])}s.$success([n()])},a=function(t){s.$failure([t])};this.all(r,a)}function e(e,n){var i=0,s=function(t){i++},r=function(){return i};t(e,s,r,n)}function n(e,n){var i=0,r=function(t){s(t)&&(i+=t)},a=function(){return i};t(e,r,a,n)}function r(e,n){var i=0,r=0,a=function(t){s(t)&&(i+=t,r++)},u=function(){return i/r};t(e,a,u,n)}function a(e,n){var i=Number.MAX_VALUE,r=function(t){s(t)&&(i=Math.min(i,t))},a=function(){return i};t(e,r,a,n)}function u(e,n){var i=Number.MAX_VALUE,r=function(t){s(t)&&(i=Math.min(i,t))},a=function(){return i};t(e,r,a,n)}var o={aggregate:g("aggregate",t),count:g("count",e),sum:g("sum",n),avg:g("avg",r),min:g("min",a),max:g("max",u)};return function(t){l(o,t)}}()),$.plugin(function(){function t(t,e){var n=function(n,i){for(var s=[],r=[],a=0;a<n.length;a++){var u=n[a],o=i[a];t(u,o)&&(r.push(u),s.push(o))}e.$success([r,s])},i=function(t){e.$failure([t])};this.all(n,i)}function e(t,e){var n=function(n,s){for(var u=[],o=[],c=0;c<n.length;c++){var h=n[c];if(i(h))if(a(t))t in h&&(u.push(h[t]),o.push(s[c]));else if(r(t)){for(var f={},l=0,d=0;d<t.length;d++){var v=t[d];v in h&&(f[v]=h[v],l++)}l>0&&(u.push(f),o.push(s[c]))}}e.$success([u,o])},s=function(n){e.$failure([t,n])};this.all(n,s)}function n(t,e,n){var i=function(){var i=this.cache;i.sort(t),e&&i.reverse(),n.$success([i.values,i.okeys])},s=function(t){n.$failure([t])};this.all(i,s)}var s={where:g("where",t),select:g("select",e),sort:g("sort",n)};return function(t){l(s,t)}}()),$.adapter("chrome-storage-local",4,function(){function t(){return chrome&&chrome.runtime&&chrome.runtime.lastError}var n=window.chrome&&chrome.storage?chrome.storage.local:!1;return{encode:function(t){return this.prefix+S(t)},decode:function(t){return E(t.substring(this.prefix.length))},valid:function(){if(!n)return!1;try{var t=Math.random(),e={};return e[t]=t,n.set(e),n.remove(t),!0}catch(i){return!1}},init:function(t,e,n){var i=new y(this,e,n);return this.prefix=h(t.prefix,this.name+"-"),this.lazy?this._finishInitialization(i,[this]):i.$bindTo(this.reload(),[this]),i},reload:function(e,i){var s=new y(this,e,i),r=this,a=this.prefix,u=new w;return n.get(null,function(e){if(t())s.$failure([t()]);else{for(var n in e)n.substring(0,a.length)===a&&u.put(n,e[n],r.decode(n));r.cache.overwrite(u),r.loaded=!0,r.finishReload(s)}}),s},_get:function(i,s,r){var a=this;n.get(s,function(n){if(t())r.$failure([i,t()]);else if(n.length){var u=E(n[0]);a.cache.put(s,u,i),r.$success([u,i])}else r.$success([e,i])})},_destroy:function(e){var i=this,s=function(){n.remove(this.cache.keys,function(){t()?e.$failure([t()]):(i.cache.reset(),e.$success())})},r=function(t){e.$failure([t])};this.loaded?s():this.reload(s,r)},_put:function(e,i,s,r,a){var u=this,o={};o[s]=i,n.set(o,function(){if(t())a.$failure([e,i,t()]);else{var n=u.cache.get(s);u.cache.put(s,i,e),a.$success([e,i,n])}})},_remove:function(e,i,s,r){var a=this;n.remove(i,function(){t()?r.$failure([e,t()]):(a.cache.remove(i),r.$success([s,e]))})},_size:function(t){var e=function(e,n){t.$success([e.length])},n=function(e){t.$failure([e])};this.reload(e,n)}}}),$.adapter("ie-userdata",1.5,{valid:function(){return o(document.body.addBehavior)},init:function(t,e,n){var i=new y(this,e,n),s=document.createElement("span");return s.style.behavior="url('#default#userData')",s.style.position="absolute",s.style.left=1e4,document.body.appendChild(s),this.store=s,this.store.load(this.name),this.lazy?this.finishInitialization(i,[this]):i.$bindTo(this.reload(),[this]),i},reload:function(t,e){for(var n=new y(this,t,e),i=this.store.XMLDocument.firstChild.attributes,s=new w,r=0;r<i.length;r++)try{var a=i[r],u=a.nodeName,o=a.nodeValue,c=this.decode(u),h=E(o);s.put(u,h,c)}catch(f){}return this.cache.overwrite(s),this.loaded=!0,this.finishReload(n),n},_get:function(t,n,i){var s=this.store.getAttribute(n);if(null===s)i.$success([e,t]);else{var r=null;try{r=E(s)}catch(a){i.$failure([a])}i.$pending()&&(this.cache.put(n,r,t),i.$success([r,t]))}},_destroy:function(t){for(var e=this.store.XMLDocument.firstChild.attributes,n=0;n<e.length;n++)this.store.removeAttribute(e[n].nodeName);this.cache.reset(),t.$success()},_put:function(t,e,n,i,s){var r=this.cache.get(n);try{this.store.setAttribute(n,i)}catch(a){s.$failure([t,e,a])}s.$pending()&&(this.cache.put(n,e,t),s.$success([t,e,r]))},_remove:function(t,e,n,i){this.store.removeAttribute(e),this.cache.remove(e),i.$success([n,t])}}),$.adapter("indexed-db",5,function(){var t=function(){return window.indexedDB||window.webkitIndexedDB||window.mozIndexedDB||window.oIndexedDB||window.msIndexedDB},n=function(){return window.IDBTransaction||window.webkitIDBTransaction||window.mozIDBTransaction||window.oIDBTransaction||window.msIDBTransaction},i=3,s=n()&&"READ_WRITE"in n()?n().READ_WRITE:"readwrite";return{valid:function(){return!!t()},init:function(e,n,s){var r=new y(this,n,s),a=this,u=t(),o=u.open(this.name,i);return o.onerror=function(t){r.$failure([t])},o.onupgradeneeded=function(){a.db=o.result,a.db.createObjectStore(a.name,{keyPath:this.key})},o.onsuccess=function(t){a.db=o.result,a.lazy?a.finishInitialization(r,[a]):r.$bindTo(a.reload(),[a])},r},reload:function(t,e){var n=new y(this,t,e),i=this,s=this.db.transaction(this.name).objectStore(this.name),r=s.openCursor(),a=new w;return r.onsuccess=function(t){var e=r.result;if(e){var s=e.key,u=e.value,o=i.decode(s);a.put(s,u,o),e["continue"]()}else i.cache.overwrite(a),i.loaded=!0,i.finishReload(n,[i.cache.values,i.cache.okeys])},r.onerror=function(t){n.$failure([keys,t])},n},_destroy:function(t){var e=this,n=this.db.transaction(this.name,s).objectStore(this.name);n.transaction.oncomplete=function(){e.cache.reset(),t.$success()},n.transaction.onabort=function(e){t.$failure([e])},n.clear()},_get:function(t,n,i){var s=this,r=this.db.transaction(this.name).objectStore(this.name),a=r.get(n);a.onsuccess=function(r){if(a.result===e)i.$success([e,t]);else{var u=a.result;s.cache.put(n,u,t),i.$success([u,t])}},a.onerror=function(){i.$failure([t,a.error])}},_put:function(t,e,n,i,r){var a=this,u=this.db.transaction(this.name,s).objectStore(this.name);u.transaction.oncomplete=function(){var i=a.cache.get(n);a.cache.put(n,e,t),r.$success([t,e,i])},u.transaction.onabort=function(n){r.$failure([t,e,n])},u.put(e,n)},_remove:function(t,e,n,i){var r=this,a=this.db.transaction(this.name,s).objectStore(this.name);a.transaction.oncomplete=function(){r.cache.remove(e),i.$success([n,t])},a.transaction.onabort=function(e){i.$failure([t,e])},a["delete"](e)},_size:function(t){var e=this.db.transaction(this.name,s).objectStore(this.name),n=e.count();n.onsuccess=function(){t.$success([n.result])},n.onerror=function(e){t.$failure([n.error])}}}}),$.adapter("local-storage",3,function(){var t=window.localStorage;return{encode:function(t){return this.prefix+S(t)},decode:function(t){return E(t.substring(this.prefix.length))},valid:function(){if(!t)return!1;try{var e=Math.random();return t.setItem(e,e),t.removeItem(e),!0}catch(n){return!1}},init:function(t,e,n){var i=new y(this,e,n);return this.prefix=h(t.prefix,this.name+"-"),this.lazy?this.finishInitialization(i,[this]):i.$bindTo(this.reload(),[this]),i},reload:function(e,n){var i=new y(this,e,n),s=this.prefix,r=new w;try{for(var a=0;a<t.length;a++){var u=t.key(a);if(u.substring(0,s.length)===s){var o=t.getItem(u),c=E(o),h=this.decode(u);r.put(u,c,h)}}this.cache.overwrite(r),this.loaded=!0}catch(f){i.$failure([f])}return this.finishReload(i),i},_destroy:function(e){var n=this,i=this.prefix,s=function(i){try{for(var s=0;s<i.length;s++)t.removeItem(i[s])}catch(r){e.$failure([r])}e.$pending()&&(n.cache.reset(),e.$success())};if(this.loaded)s(this.cache.keys);else{var r=[];try{for(var a=0;a<t.length;a++){var u=t.key(a);u.substring(0,i.length)===i&&r.push(u)}}catch(o){e.$failure([o])}e.$pending()&&s(r)}},_get:function(n,i,s){try{var r=t.getItem(i);if(null===r)s.$success([e,n]);else{var a=E(r);this.cache.put(i,a,n),s.$success([a,n])}}catch(u){s.$failure([n,u])}},_put:function(e,n,i,s,r){try{t.setItem(i,s)}catch(a){r.$failure([e,n,a])}if(r.$pending()){var u=this.cache.get(i);this.cache.put(i,n,e),r.$success([e,n,u])}},_remove:function(e,n,i,s){try{t.removeItem(n)}catch(r){s.$failure([e,r])}s.$pending()&&(this.cache.remove(n),s.$success([i,e]))},_size:function(t){var e=function(e,n){t.$success([e.length])},n=function(e){t.$failure([e])};this.reload(e,n)}}}),$.adapter("memory",1,{valid:function(){return!0},init:function(t,e,n){var i=new y(this,e,n);return this.loaded=!0,this.finishInitialization(i,[this]),i},reload:function(t,e){var n=new y(this,t,e);return this.finishReload(n),n},_destroy:function(t){this.cache.reset(),t.$success()},_put:function(t,e,n,i,s){var r=this.cache.get(n);this.cache.put(n,e,t),s.$success([t,e,r])},_remove:function(t,e,n,i){this.cache.remove(e),i.$success([n,t])}}),$.adapter("webkit-sqlite",6,function(){function t(t,e){return t.replace(/\{(\d+)\}/g,function(t,n){return n=parseInt(n),isNaN(n)||0>n||n>=e.length?t:e[n]})}var n="stork",i="CREATE TABLE IF NOT EXISTS {0} (id TEXT PRIMARY KEY, value TEXT)",s="SELECT value FROM {0} WHERE id = ?",r="SELECT id, value FROM {0}",a="SELECT id, value FROM {0} WHERE id IN ({1})",o="INSERT OR REPLACE INTO {0} (id, value) VALUES (?, ?)",c="DELETE FROM {0} WHERE id = ?",f="SELECT COUNT(*) as count FROM {0}",l="DELETE FROM {0}",d="DELETE FROM {0} WHERE id IN ({1})";return{valid:function(){return!!window.openDatabase},init:function(e,a,u){var d=new y(this,a,u),v=h(e.database,n),p=h(e.size,65536),g=h(e.version,"1.0"),m=this,$=function(t,e){d.$failure([e])},w=function(t){t.executeSql(m.SQL_CREATE,[],S,$)},S=function(t,e){m.lazy?m.finishInitialization(d,[m]):d.$bindTo(m.reload(),[m])};return this.SQL_CREATE=t(i,[this.name]),this.SQL_SELECT=t(s,[this.name]),this.SQL_SELECT_ALL=t(r,[this.name]),this.SQL_INSERT=t(o,[this.name]),this.SQL_DELETE=t(c,[this.name]),this.SQL_DESTROY=t(l,[this.name]),this.SQL_COUNT=t(f,[this.name]),this.db=openDatabase(v,g,v,p),this.db.transaction(w,$),d},reload:function(t,e){var n=new y(this,t,e),i=this,s=function(t,e){n.$failure([e])},r=function(t){t.executeSql(i.SQL_SELECT_ALL,[],a,s)},a=function(t,e){var s=new w;try{for(var r=0;r<e.rows.length;r++){var a=e.rows[r],u=E(a.value),o=E(a.id);s.put(a.id,u,o)}i.cache.overwrite(s),i.loaded=!0}catch(c){n.$failure([c])}i.finishReload(n)};return this.db.readTransaction(r,s),n},_get:function(t,n,i){var s=this,r=function(e,n){i.$failure([t,n])},a=function(t){t.executeSql(s.SQL_SELECT,[n],u,r)},u=function(r,a){var u=e;try{var o=a.rows[0];o&&o.value!==e&&(u=E(o.value))}catch(c){i.$failure([t,c])}i.$pending()&&(u!==e?(s.cache.put(n,u,t),i.$success([u,t])):i.$success([e,t]))};this.db.readTransaction(a,r)},_destroy:function(t){var e=this,n=function(t){t.executeSql(e.SQL_DESTROY,[],i,s)},i=function(n,i){e.cache.reset(),t.$success()},s=function(e,n){t.$failure([n])};this.db.transaction(n,s)},_put:function(t,e,n,i,s){var r=this,a=function(t){t.executeSql(r.SQL_INSERT,[n,i],u,o)},u=function(i,a){var u=r.cache.get(n);r.cache.put(n,e,t),s.$success([t,e,u])},o=function(n,i){s.$failure([t,e,i])};this.db.transaction(a,o)},_remove:function(t,e,n,i){var s=this,r=function(t){t.executeSql(s.SQL_DELETE,[e],a,u)},a=function(r,a){s.cache.remove(e),i.$success([n,t])},u=function(e,n){i.$failure([t,n])};this.db.transaction(r,u)},_size:function(t){var e=this,n=function(e,n){t.$failure([n])},i=function(t){t.executeSql(e.SQL_COUNT,[],s,n)},s=function(e,n){t.$success([n.rows[0].count])};this.db.readTransaction(i,n)},batch:function(t,e,n){var i=new y(this,e,n);if(this.handlePending(this.batch,arguments,i))return i;var s=this,r=this.key,a=0,o=[];try{for(var c=0;c<t.length;c++){var h=t[c],f=h[r];u(f)&&(f=h[r]=v()),o.push({value:h,key:f,rawKey:S(f),rawValue:S(h)})}}catch(l){return i.$failure([t,a,l]),i}var d=function(t){for(var e=0;e<o.length;e++){var n=o[e];t.executeSql(s.SQL_INSERT,[n.rawKey,n.rawValue],p,g)}},p=function(e,n){if(++a===t.length&&i.$pending()){for(var r=0;r<o.length;r++){var u=o[r];s.cache.put(u.rawKey,u.value,u.key)}i.$success([t])}},g=function(e,n){i.$failure([t,a,n])};return this.db.transaction(d,g),i},removeMany:function(e,n,i){var s=new y(this,n,i);if(this.handlePending(this.removeMany,arguments,s))return s;var r=this,a=[],u=[],o=[],c="",h=function(t){t.executeSql(c,a,f,l)},f=function(t,n){for(var i=0;i<a.length;i++)r.cache.remove(a[i]);s.$success([u,e])},l=function(t,e){s.$failure([u,0,e])};try{for(var v=0;v<e.length;v++){var p=S(e[v]);this.cache.has(p)&&(a[v]=p,u[v]=this.cache.get(p),o[v]="?")}c=t(d,[this.name,o.join(",")])}catch(g){s.$failure([u,g])}return s.$pending()&&this.db.transaction(h,l),s},getMany:function(e,n,i){var s=new y(this,n,i);if(this.handlePending(this.removeMany,arguments,s))return s;var r=this,u=[],o=[],c=[],h=[],f="",l=function(t){t.executeSql(f,u,d,v)},d=function(t,n){for(var i=0;i<n.rows.length;i++)for(var a=n.rows[i],h=0;h<u.length;h++)if(u[h]===a.id){var f=E(a.value),l=o[h];c[l]=f,r.cache.put(a.id,f,e[l])}s.$success([c,e])},v=function(t,n){s.$failure([e,n])};try{for(var p=0;p<e.length;p++){var g=S(e[p]);this.cache.has(g)?c[p]=this.cache.get(g):(u.push(g),o.push(p),h.push("?"))}f=t(a,[this.name,h.join(",")])}catch(m){s.$failure([c,m])}return s.$pending()&&(u.length?this.db.transaction(l,v):s.$success([c,e])),s}}}),$.adapter("window-name",2,function(){function t(){if(!t.cache)try{t.cache=E(window.top.name)}catch(e){t.cache={}}return t.cache}function e(){try{window.top.name=S(t())}catch(e){}}return{encode:function(t){return this.prefix+S(t)},decode:function(t){return E(t.substring(this.prefix.length))},valid:function(){return window.top&&"undefined"!=typeof window.top.name},init:function(t,e,n){var i=new y(this,e,n);return this.prefix=h(t.prefix,this.name+"-"),i.$bindTo(this.reload(),[this]),i},reload:function(e,n){var i=new y(this,e,n),s=this.prefix,r=new w,a=t();try{for(var u in a)if(u.substring(0,s.length)===s){var o=a[u],c=E(o),h=this.decode(u);r.put(u,c,h)}this.cache.overwrite(r),this.loaded=!0}catch(f){i.$failure([f])}return this.finishReload(i),i},_destroy:function(n){for(var i=this.cache.keys,s=t(),r=0;r<i.length;r++)delete s[i[r]];this.cache.reset(),e(),n.$success()},_put:function(n,i,s,r,a){var u=t(),o=this.cache.get(s);u[s]=i,this.cache.put(s,i,n),e(),a.$success([n,i,o])},_remove:function(n,i,s,r){var a=t();delete a[i],this.cache.remove(i),e(),r.$success([s,n])}}}),t.Stork=$,t.Stork.getAdapter=m,t.Stork.Promise=y,t.Stork.FastMap=w}(window);
//# sourceMappingURL=stork.min.js.map
