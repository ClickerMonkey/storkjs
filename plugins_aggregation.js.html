<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <title>Source: plugins/aggregation.js</title>
    
    
    <script src="scripts/prettify/prettify.js"></script>
    <script src="scripts/prettify/lang-css.js"></script>
    <script src="scripts/jquery.min.js"></script>
    <!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <link type="text/css" rel="stylesheet" href="styles/prettify-tomorrow.css">
    <link type="text/css" rel="stylesheet" href="styles/bootstrap.min.css">
    <link type="text/css" rel="stylesheet" href="styles/jaguar.css">
    
    
    <script>
    var config = {"monospaceLinks":false,"cleverLinks":true,"applicationName":"Stork JS","linenums":true,"default":{"outputSourceFiles":true}};
    </script>
    

    
</head>
<body>
<div id="wrap" class="clearfix">
    
<div class="navigation">
    <h3 class="applicationName"><a href="index.html">Stork JS</a></h3>

    <div class="search">
        <input id="search" type="text" class="form-control input-sm" placeholder="Search Documentations">
    </div>
    <ul class="list">
    
        <li class="item" data-name="Stork">
            <span class="title">
                <a href="Stork.html">Stork</a>
                
            </span>
            <ul class="members itemMembers">
            
            <span class="subtitle">Members</span>
            
                <li data-name="Stork.adapters"><a href="Stork.html#.adapters">adapters</a></li>
            
                <li data-name="Stork.plugins"><a href="Stork.html#.plugins">plugins</a></li>
            
                <li data-name="Stork#adapter"><a href="Stork.html#adapter">adapter</a></li>
            
                <li data-name="Stork#cache"><a href="Stork.html#cache">cache</a></li>
            
                <li data-name="Stork#initialized"><a href="Stork.html#initialized">initialized</a></li>
            
                <li data-name="Stork#key"><a href="Stork.html#key">key</a></li>
            
                <li data-name="Stork#lazy"><a href="Stork.html#lazy">lazy</a></li>
            
                <li data-name="Stork#loaded"><a href="Stork.html#loaded">loaded</a></li>
            
                <li data-name="Stork#name"><a href="Stork.html#name">name</a></li>
            
                <li data-name="Stork#options"><a href="Stork.html#options">options</a></li>
            
                <li data-name="Stork#pending"><a href="Stork.html#pending">pending</a></li>
            
            </ul>
            <ul class="typedefs itemMembers">
            
            <span class="subtitle">Typedefs</span>
            
                <li data-name="Stork~aggregateAccumulate"><a href="Stork.html#~aggregateAccumulate">aggregateAccumulate</a></li>
            
                <li data-name="Stork~aggregateFailure"><a href="Stork.html#~aggregateFailure">aggregateFailure</a></li>
            
                <li data-name="Stork~aggregateResult"><a href="Stork.html#~aggregateResult">aggregateResult</a></li>
            
                <li data-name="Stork~aggregateSuccess"><a href="Stork.html#~aggregateSuccess">aggregateSuccess</a></li>
            
                <li data-name="Stork~allFailure"><a href="Stork.html#~allFailure">allFailure</a></li>
            
                <li data-name="Stork~allSuccess"><a href="Stork.html#~allSuccess">allSuccess</a></li>
            
                <li data-name="Stork~batchFailure"><a href="Stork.html#~batchFailure">batchFailure</a></li>
            
                <li data-name="Stork~batchSuccess"><a href="Stork.html#~batchSuccess">batchSuccess</a></li>
            
                <li data-name="Stork~destroyFailure"><a href="Stork.html#~destroyFailure">destroyFailure</a></li>
            
                <li data-name="Stork~destroySuccess"><a href="Stork.html#~destroySuccess">destroySuccess</a></li>
            
                <li data-name="Stork~eachFailure"><a href="Stork.html#~eachFailure">eachFailure</a></li>
            
                <li data-name="Stork~eachSuccess"><a href="Stork.html#~eachSuccess">eachSuccess</a></li>
            
                <li data-name="Stork~getFailure"><a href="Stork.html#~getFailure">getFailure</a></li>
            
                <li data-name="Stork~getManyFailure"><a href="Stork.html#~getManyFailure">getManyFailure</a></li>
            
                <li data-name="Stork~getManySuccess"><a href="Stork.html#~getManySuccess">getManySuccess</a></li>
            
                <li data-name="Stork~getSuccess"><a href="Stork.html#~getSuccess">getSuccess</a></li>
            
                <li data-name="Stork~initFailure"><a href="Stork.html#~initFailure">initFailure</a></li>
            
                <li data-name="Stork~initSuccess"><a href="Stork.html#~initSuccess">initSuccess</a></li>
            
                <li data-name="Stork~plugin"><a href="Stork.html#~plugin">plugin</a></li>
            
                <li data-name="Stork~putFailure"><a href="Stork.html#~putFailure">putFailure</a></li>
            
                <li data-name="Stork~putSuccess"><a href="Stork.html#~putSuccess">putSuccess</a></li>
            
                <li data-name="Stork~reloadFailure"><a href="Stork.html#~reloadFailure">reloadFailure</a></li>
            
                <li data-name="Stork~reloadSuccess"><a href="Stork.html#~reloadSuccess">reloadSuccess</a></li>
            
                <li data-name="Stork~removeFailure"><a href="Stork.html#~removeFailure">removeFailure</a></li>
            
                <li data-name="Stork~removeManyFailure"><a href="Stork.html#~removeManyFailure">removeManyFailure</a></li>
            
                <li data-name="Stork~removeManySuccess"><a href="Stork.html#~removeManySuccess">removeManySuccess</a></li>
            
                <li data-name="Stork~removeSuccess"><a href="Stork.html#~removeSuccess">removeSuccess</a></li>
            
                <li data-name="Stork~saveFailure"><a href="Stork.html#~saveFailure">saveFailure</a></li>
            
                <li data-name="Stork~saveSuccess"><a href="Stork.html#~saveSuccess">saveSuccess</a></li>
            
                <li data-name="Stork~selectFailure"><a href="Stork.html#~selectFailure">selectFailure</a></li>
            
                <li data-name="Stork~selectSuccess"><a href="Stork.html#~selectSuccess">selectSuccess</a></li>
            
                <li data-name="Stork~sizeFailure"><a href="Stork.html#~sizeFailure">sizeFailure</a></li>
            
                <li data-name="Stork~sizeSuccess"><a href="Stork.html#~sizeSuccess">sizeSuccess</a></li>
            
                <li data-name="Stork~sortComparator"><a href="Stork.html#~sortComparator">sortComparator</a></li>
            
                <li data-name="Stork~sortFailure"><a href="Stork.html#~sortFailure">sortFailure</a></li>
            
                <li data-name="Stork~sortSuccess"><a href="Stork.html#~sortSuccess">sortSuccess</a></li>
            
                <li data-name="Stork~where"><a href="Stork.html#~where">where</a></li>
            
                <li data-name="Stork~whereFailure"><a href="Stork.html#~whereFailure">whereFailure</a></li>
            
                <li data-name="Stork~whereSuccess"><a href="Stork.html#~whereSuccess">whereSuccess</a></li>
            
            </ul>
            <ul class="methods itemMembers">
            
            <span class="subtitle">Methods</span>
            
                <li data-name="Stork.adapter"><a href="Stork.html#.adapter">adapter</a></li>
            
                <li data-name="Stork.plugin"><a href="Stork.html#.plugin">plugin</a></li>
            
                <li data-name="Stork#aggregate"><a href="Stork.html#aggregate">aggregate</a></li>
            
                <li data-name="Stork#all"><a href="Stork.html#all">all</a></li>
            
                <li data-name="Stork#avg"><a href="Stork.html#avg">avg</a></li>
            
                <li data-name="Stork#batch"><a href="Stork.html#batch">batch</a></li>
            
                <li data-name="Stork#count"><a href="Stork.html#count">count</a></li>
            
                <li data-name="Stork#destroy"><a href="Stork.html#destroy">destroy</a></li>
            
                <li data-name="Stork#each"><a href="Stork.html#each">each</a></li>
            
                <li data-name="Stork#get"><a href="Stork.html#get">get</a></li>
            
                <li data-name="Stork#getMany"><a href="Stork.html#getMany">getMany</a></li>
            
                <li data-name="Stork#init"><a href="Stork.html#init">init</a></li>
            
                <li data-name="Stork#max"><a href="Stork.html#max">max</a></li>
            
                <li data-name="Stork#min"><a href="Stork.html#min">min</a></li>
            
                <li data-name="Stork#put"><a href="Stork.html#put">put</a></li>
            
                <li data-name="Stork#reload"><a href="Stork.html#reload">reload</a></li>
            
                <li data-name="Stork#remove"><a href="Stork.html#remove">remove</a></li>
            
                <li data-name="Stork#removeMany"><a href="Stork.html#removeMany">removeMany</a></li>
            
                <li data-name="Stork#save"><a href="Stork.html#save">save</a></li>
            
                <li data-name="Stork#select"><a href="Stork.html#select">select</a></li>
            
                <li data-name="Stork#size"><a href="Stork.html#size">size</a></li>
            
                <li data-name="Stork#sort"><a href="Stork.html#sort">sort</a></li>
            
                <li data-name="Stork#sum"><a href="Stork.html#sum">sum</a></li>
            
                <li data-name="Stork#then"><a href="Stork.html#then">then</a></li>
            
                <li data-name="Stork#valid"><a href="Stork.html#valid">valid</a></li>
            
                <li data-name="Stork#where"><a href="Stork.html#where">where</a></li>
            
            </ul>
            <ul class="events itemMembers">
            
            </ul>
        </li>
    
        <li class="item" data-name="Stork.FastMap">
            <span class="title">
                <a href="Stork.FastMap.html">Stork.FastMap</a>
                
            </span>
            <ul class="members itemMembers">
            
            </ul>
            <ul class="typedefs itemMembers">
            
            </ul>
            <ul class="methods itemMembers">
            
            <span class="subtitle">Methods</span>
            
                <li data-name="Stork.FastMap#get"><a href="Stork.FastMap.html#get">get</a></li>
            
                <li data-name="Stork.FastMap#has"><a href="Stork.FastMap.html#has">has</a></li>
            
                <li data-name="Stork.FastMap#hasOverlap"><a href="Stork.FastMap.html#hasOverlap">hasOverlap</a></li>
            
                <li data-name="Stork.FastMap#indexOf"><a href="Stork.FastMap.html#indexOf">indexOf</a></li>
            
                <li data-name="Stork.FastMap#put"><a href="Stork.FastMap.html#put">put</a></li>
            
                <li data-name="Stork.FastMap#putMap"><a href="Stork.FastMap.html#putMap">putMap</a></li>
            
                <li data-name="Stork.FastMap#rebuildIndex"><a href="Stork.FastMap.html#rebuildIndex">rebuildIndex</a></li>
            
                <li data-name="Stork.FastMap#remove"><a href="Stork.FastMap.html#remove">remove</a></li>
            
                <li data-name="Stork.FastMap#removeAt"><a href="Stork.FastMap.html#removeAt">removeAt</a></li>
            
                <li data-name="Stork.FastMap#reset"><a href="Stork.FastMap.html#reset">reset</a></li>
            
                <li data-name="Stork.FastMap#reverse"><a href="Stork.FastMap.html#reverse">reverse</a></li>
            
                <li data-name="Stork.FastMap#size"><a href="Stork.FastMap.html#size">size</a></li>
            
                <li data-name="Stork.FastMap#sort"><a href="Stork.FastMap.html#sort">sort</a></li>
            
            </ul>
            <ul class="events itemMembers">
            
            </ul>
        </li>
    
        <li class="item" data-name="Stork.Promise">
            <span class="title">
                <a href="Stork.Promise.html">Stork.Promise</a>
                
            </span>
            <ul class="members itemMembers">
            
            <span class="subtitle">Members</span>
            
                <li data-name="Stork.Promise.CHAINED"><a href="Stork.Promise.html#.CHAINED">CHAINED</a></li>
            
                <li data-name="Stork.Promise.FAILURE"><a href="Stork.Promise.html#.FAILURE">FAILURE</a></li>
            
                <li data-name="Stork.Promise.PENDING"><a href="Stork.Promise.html#.PENDING">PENDING</a></li>
            
                <li data-name="Stork.Promise.SUCCESS"><a href="Stork.Promise.html#.SUCCESS">SUCCESS</a></li>
            
                <li data-name="Stork.Promise#args"><a href="Stork.Promise.html#args">args</a></li>
            
                <li data-name="Stork.Promise#context"><a href="Stork.Promise.html#context">context</a></li>
            
                <li data-name="Stork.Promise#errors"><a href="Stork.Promise.html#errors">errors</a></li>
            
                <li data-name="Stork.Promise#failures"><a href="Stork.Promise.html#failures">failures</a></li>
            
                <li data-name="Stork.Promise#next"><a href="Stork.Promise.html#next">next</a></li>
            
                <li data-name="Stork.Promise#root"><a href="Stork.Promise.html#root">root</a></li>
            
                <li data-name="Stork.Promise#state"><a href="Stork.Promise.html#state">state</a></li>
            
                <li data-name="Stork.Promise#successes"><a href="Stork.Promise.html#successes">successes</a></li>
            
            </ul>
            <ul class="typedefs itemMembers">
            
            </ul>
            <ul class="methods itemMembers">
            
            <span class="subtitle">Methods</span>
            
                <li data-name="Stork.Promise#error"><a href="Stork.Promise.html#error">error</a></li>
            
                <li data-name="Stork.Promise#then"><a href="Stork.Promise.html#then">then</a></li>
            
            </ul>
            <ul class="events itemMembers">
            
            </ul>
        </li>
    
    </ul>
</div>
    <div class="main">
        <h1 class="page-title" data-filename="plugins_aggregation.js.html">Source: plugins/aggregation.js</h1>
        


    
    <section>
        <article>
            <pre class="prettyprint source linenums"><code>Stork.plugin((function()
{

  /**
   * The format of success callback for aggregation functions.
   * 
   * @callback Stork~aggregateSuccess
   * @param {Number} aggregatedValue
   *        The result of the aggregation function.
   */

  /**
   * The format of failure callback for aggregation functions.
   * 
   * @callback Stork~aggregateFailure
   * @param {Any} error 
   *        The error that was thrown.
   */
  
  /**
   * The format of an accumulation callback for aggregation functions.
   *
   * @callback Stork~aggregateAccumulate
   * @param {Any} value
   *        The value to process for accumulation.
   */
  
  /**
   * The format of an accumulation callback for aggregation functions.
   *
   * @callback Stork~aggregateResult
   * @return {Any}
   *         The result of the accumulated values.
   */

  /**
   * Performs an aggregation on key-value pairs where the value is an `Object` 
   * which may have a specific property to aggregate. The result of the 
   * aggregation is returned to the callback.
   *
   * This is part of the aggregation plugin.
   * 
   * @memberOf Stork#
   * @param  {String} property
   *         The property on the object to pass to the accumulation function.
   * @param  {Stork~aggregateAccumulate} accumulate
   *         The function to invoke with the value of the property.
   * @param  {Stork~aggregateResult} getResult
   *         The function to call at the end to returned the aggregated value.
   * @param  {Stork~aggregateSuccess} [success]
   *         The function to invoke when a value is successfully aggregated.
   * @param  {Stork~aggregateSuccess} [failure]
   *         The function to invoke if there's a problem.
   * @return {Stork.Promise} -
   *         The promise that can be used to listen for success or failure, as
   *         well as chaining additional calls.
   */
  function aggregate(property, accumulate, getResult, promise)
  {
    var onSuccess = function(values, keys)
    {
      var returnedValue = undefined;

      for (var i = 0; i &lt; values.length; i++)
      {
        var v = values[ i ];

        if (isObject( v ) &amp;&amp; property in v)
        {
          accumulate( v[ property ] );
        }
      }

      promise.$success( [ getResult() ] )
    };
    var onFailure = function(e)
    {
      promise.$failure( [e] );
    };

    this.all( onSuccess, onFailure );
  }

  /**
   * Returns the number of values that are objects and have the specified 
   * property to the callback.
   *
   * This is part of the aggregation plugin.
   *
   * *Usage*
   * ```javascript
   * db.count('name', function(count) {
   *   // count = the number of objects with the property 'name'
   * });
   * ```
   * 
   * @memberOf Stork#
   * @param  {String} property
   *         The property on the object to look for.
   * @param  {Stork~aggregateSuccess} [success]
   *         The function to invoke with the number of values with the property.
   * @param  {Stork~aggregateSuccess} [failure]
   *         The function to invoke if there's a problem.
   * @return {Stork.Promise} -
   *         The promise that can be used to listen for success or failure, as
   *         well as chaining additional calls.
   */
  function count(property, promise)
  {
    var total = 0;

    var accumulate = function(v)
    {
      total++;
    };
    var getResult = function()
    {
      return total;
    };

    aggregate( property, accumulate, getResult, promise );
  }

  /**
   * Returns the sum of a set of values taken from a property on all `Object` 
   * values to the callback.
   *
   * This is part of the aggregation plugin.
   * 
   * *Usage*
   * ```javascript
   * db.sum('kills', function(sum) {
   *   // sum = total of all kills
   * });
   * ```
   * 
   * @memberOf Stork#
   * @param  {String} property
   *         The property on the object to sum.
   * @param  {Stork~aggregateSuccess} [success]
   *         The function to invoke with the sum.
   * @param  {Stork~aggregateSuccess} [failure]
   *         The function to invoke if there's a problem.
   * @return {Stork.Promise} -
   *         The promise that can be used to listen for success or failure, as
   *         well as chaining additional calls.
   */
  function sum(property, promise)
  {
    var summing = 0;

    var accumulate = function(v)
    {
      if (isNumber(v))
      {
        summing += v;
      }
    };
    var getResult = function()
    {
      return summing;
    };

    aggregate( property, accumulate, getResult, promise );
  }


  /**
   * Returns the average of a set of values taken from a property on all `Object` 
   * values to the callback.
   *
   * This is part of the aggregation plugin.
   * 
   * *Usage*
   * ```javascript
   * db.avg('age', function(avg) {
   *   // avg = the average age
   * });
   * ```
   * 
   * @memberOf Stork#
   * @param  {String} property
   *         The property on the object to average.
   * @param  {Stork~aggregateSuccess} [success]
   *         The function to invoke with the average.
   * @param  {Stork~aggregateSuccess} [failure]
   *         The function to invoke if there's a problem.
   * @return {Stork.Promise} -
   *         The promise that can be used to listen for success or failure, as
   *         well as chaining additional calls.
   */
  function avg(property, promise)
  {
    var summing = 0;
    var total = 0;

    var accumulate = function(v)
    {
      if (isNumber(v))
      {
        summing += v;
        total++;
      }
    };
    var getResult = function()
    {
      return summing / total;
    };

    aggregate( property, accumulate, getResult, promise );
  }

  /**
   * Returns the minimum value of a set of values taken from a property on all 
   * `Object` values to the callback.
   *
   * This is part of the aggregation plugin.
   * 
   * *Usage*
   * ```javascript
   * db.min('age', function(min) {
   *   // min = the minimum age
   * });
   * ```
   * 
   * @memberOf Stork#
   * @param  {String} property
   *         The property on the object to find the minimum value of.
   * @param  {Stork~aggregateSuccess} [success]
   *         The function to invoke with the minimum value.
   * @param  {Stork~aggregateSuccess} [failure]
   *         The function to invoke if there's a problem.
   * @return {Stork.Promise} -
   *         The promise that can be used to listen for success or failure, as
   *         well as chaining additional calls.
   */
  function min(property, promise)
  {
    var minValue = Number.MAX_VALUE;

    var accumulate = function(v)
    {
      if (isNumber(v))
      {
        minValue = Math.min( minValue, v );
      }
    };
    var getResult = function()
    {
      return minValue;
    };

    aggregate( property, accumulate, getResult, promise );
  }

  /**
   * Returns the maximum value of a set of values taken from a property on all 
   * `Object` values to the callback.
   *
   * This is part of the aggregation plugin.
   * 
   * *Usage*
   * ```javascript
   * db.max('age', function(max) {
   *   // max = the maximum age
   * });
   * ```
   * 
   * @memberOf Stork#
   * @param  {String} property
   *         The property on the object to find the maximum value of.
   * @param  {Stork~aggregateSuccess} [success]
   *         The function to invoke with the maximum value.
   * @param  {Stork~aggregateSuccess} [failure]
   *         The function to invoke if there's a problem.
   * @return {Stork.Promise} -
   *         The promise that can be used to listen for success or failure, as
   *         well as chaining additional calls.
   */
  function max(property, promise)
  {
    var maxValue = Number.MAX_VALUE;

    var accumulate = function(v)
    {
      if (isNumber(v))
      {
        maxValue = Math.min( maxValue, v );
      }
    };
    var getResult = function()
    {
      return maxValue;
    };

    aggregate( property, accumulate, getResult, promise );
  }

  var METHODS = 
  {
    aggregate:  $promise( 'aggregate', aggregate ),
    count:      $promise( 'count', count ),
    sum:        $promise( 'sum', sum ),
    avg:        $promise( 'avg', avg ),
    min:        $promise( 'min', min ),
    max:        $promise( 'max', max )
  }; 

  return function(stork)
  {
    copy( METHODS, stork );
  };

})());


  </code></pre>
        </article>
    </section>






        

        <footer>
            Documentation generated by <a href="https://github.com/jsdoc3/jsdoc">JSDoc 3.3.3</a> on Mon Oct 19 2015 23:28:47 GMT-0400 (EDT)
        </footer>
    </div>
</div>
<script>prettyPrint();</script>
<script src="scripts/linenumber.js"></script>
<script src="scripts/main.js"></script>
</body>
</html>
